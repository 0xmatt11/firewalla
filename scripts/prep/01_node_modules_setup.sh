#!/bin/bash

rc=0

CPU_PLATFORM=$(uname -m)
branch=$(git rev-parse --abbrev-ref HEAD)
: ${NM_DIR:=/home/pi/.node_modules}
: ${FIREWALLA_HOME:=/home/pi/firewalla}

NODE_VERSION=$(${FIREWALLA_HOME}/bin/node -v 2>/dev/null)

NM_ARM_NODE8_URL=https://github.com/firewalla/fnm.node8.armv7l.git

if [[ $CPU_PLATFORM == "armv7l" && ${NODE_VERSION:0:2} == 'v8' ]]; then
  
  # make sure node_modules use the right repo
  cd $NM_DIR
  NM_URL=$(git remote get-url origin)
  
  if [[ "$NM_URL" != "$NM_ARM_NODE8_URL" ]]; then
    git remote remove origin
    git remote add origin $NM_ARM_NODE8_URL
    git pull origin $branch
  fi    
  
fi



